<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Můj Counter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f5;
      color: #111;
    }

    body {
      margin: 0;
      padding: 1rem;
      max-width: 900px;
      margin-inline: auto;
      background: #f5f5f5;
    }

    h1 {
      font-size: 1.4rem;
      margin: 0 0 0.8rem 0;
      text-align: left;
    }

    .top-bar {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.8rem;
    }

    .top-bar input {
      flex: 1;
      padding: 0.5rem 0.7rem;
      border-radius: 999px;
      border: 1px solid #d4d4d4;
      background: #fff;
      font-size: 0.95rem;
    }

    .btn {
      padding: 0.5rem 0.9rem;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      user-select: none;
    }

    .btn:active {
      transform: scale(0.97);
    }

    .btn-primary {
      background: #3a86ff;
      color: #fff;
    }

    .btn-secondary {
      background: #eee;
      color: #222;
    }

    .btn-danger {
      background: #ef4444;
      color: #fff;
    }

    .counters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 0.8rem;
      margin-top: 0.6rem;
    }

    .counter-card {
      background: #fff;
      border-radius: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      padding: 0.7rem 0.7rem 0.8rem 0.7rem;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      border: 2px solid transparent;
      transition: transform 0.05s ease-out, box-shadow 0.05s ease-out;
    }

    .counter-card:active {
      transform: translateY(1px);
      box-shadow: 0 1px 4px rgba(0,0,0,0.12);
    }

    .counter-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.4rem;
    }

    .counter-name {
      font-weight: 600;
      font-size: 0.95rem;
      border: none;
      background: transparent;
      padding: 0.1rem 0.3rem;
      border-radius: 0.4rem;
      max-width: 100%;
    }

    .counter-name:focus {
      outline: 1px solid #3a86ff;
      background: #f3f4ff;
    }

    .color-btn {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      flex-shrink: 0;
      box-shadow: 0 0 0 2px #fff, 0 0 0 3px rgba(0,0,0,0.08);
    }

    .counter-value-wrapper {
      background: #f9fafb;
      border-radius: 0.8rem;
      padding: 0.3rem 0.4rem 0.5rem 0.4rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-top: 0.1rem;
    }

    .counter-value {
      font-size: 1.7rem;
      font-weight: 700;
      text-align: center;
      margin: 0.15rem 0 0.1rem 0;
    }

    .counter-buttons-main {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.3rem;
      margin-top: 0.2rem;
      width: 100%;
    }

    .counter-buttons-main .btn {
      border-radius: 0.7rem;
      padding-block: 0.45rem;
      font-size: 1rem;
    }

    .counter-buttons-extra {
      display: flex;
      gap: 0.3rem;
      margin-top: 0.35rem;
      width: 100%;
      justify-content: space-between;
    }

    .counter-buttons-extra .btn {
      flex: 1;
      font-size: 0.8rem;
      padding-block: 0.35rem;
      border-radius: 999px;
    }

    .footer {
      margin-top: 1rem;
      font-size: 0.75rem;
      text-align: center;
      color: #888;
    }
  </style>
</head>
<body>
  <h1>All counters</h1>

  <div class="top-bar">
    <input id="newCounterName" type="text" placeholder="Název počítadla (např. Pull ups)">
    <button class="btn btn-primary" id="addCounterBtn">+ Přidat</button>
  </div>

  <div id="counters" class="counters"></div>

  <div class="footer">
    Hodnoty se ukládají jen do tohoto zařízení (localStorage).
  </div>

  <script>
    const STORAGE_KEY = "my_counter_app_v2";

    // předdefinovaná paleta barev (podobně jako na screenu)
    const COLORS = [
      "#f97316", // oranžová
      "#6b7280", // šedá
      "#2563eb", // modrá
      "#ec4899", // růžová
      "#10b981", // zelená
      "#7c3aed"  // fialová
    ];

    // jednoduchý "click" zvuk přes Web Audio API
    let audioContext = null;
    function playClickSound() {
      try {
        if (!audioContext) {
          const AC = window.AudioContext || window.webkitAudioContext;
          if (!AC) return;
          audioContext = new AC();
        }
        const duration = 0.05;
        const osc = audioContext.createOscillator();
        const gain = audioContext.createGain();

        osc.type = "square";
        osc.frequency.value = 700;

        gain.gain.setValueAtTime(0.2, audioContext.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);

        osc.connect(gain);
        gain.connect(audioContext.destination);

        osc.start();
        osc.stop(audioContext.currentTime + duration);
      } catch (e) {
        // v nejhorším prostě jen ticho
        console.warn("Audio error:", e);
      }
    }

    function loadCounters() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return [];
      try {
        const data = JSON.parse(raw);
        return Array.isArray(data) ? data : [];
      } catch {
        return [];
      }
    }

    function saveCounters(counters) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(counters));
    }

    function createId() {
      return "c_" + Date.now().toString(36) + "_" + Math.random().toString(36).slice(2, 7);
    }

    let counters = loadCounters();

    function renderCounters() {
      const container = document.getElementById("counters");
      container.innerHTML = "";

      if (counters.length === 0) {
        const empty = document.createElement("div");
        empty.textContent = "Zatím žádné počítadlo. Přidej si první nahoře.";
        empty.style.color = "#888";
        empty.style.fontSize = "0.9rem";
        empty.style.gridColumn = "1 / -1";
        container.appendChild(empty);
        return;
      }

      counters.forEach(counter => {
        const color = counter.color || COLORS[0];

        const card = document.createElement("div");
        card.className = "counter-card";
        card.dataset.id = counter.id;
        card.style.borderColor = color;

        const header = document.createElement("div");
        header.className = "counter-header";

        const nameInput = document.createElement("input");
        nameInput.className = "counter-name";
        nameInput.value = counter.name || "Bez názvu";
        nameInput.addEventListener("change", () => {
          updateCounterName(counter.id, nameInput.value.trim() || "Bez názvu");
        });

        const colorBtn = document.createElement("button");
        colorBtn.className = "color-btn";
        colorBtn.style.background = color;
        colorBtn.title = "Změnit barvu";
        colorBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          cycleColor(counter.id);
        });

        header.appendChild(nameInput);
        header.appendChild(colorBtn);

        const valueWrapper = document.createElement("div");
        valueWrapper.className = "counter-value-wrapper";

        const valueEl = document.createElement("div");
        valueEl.className = "counter-value";
        valueEl.textContent = counter.value;
        valueEl.style.color = color;

        const mainButtons = document.createElement("div");
        mainButtons.className = "counter-buttons-main";

        const minusBtn = document.createElement("button");
        minusBtn.className = "btn btn-secondary";
        minusBtn.textContent = "–";
        minusBtn.addEventListener("click", () => changeValue(counter.id, -1));

        const plusBtn = document.createElement("button");
        plusBtn.className = "btn btn-primary";
        plusBtn.textContent = "+";
        plusBtn.style.background = color;
        plusBtn.addEventListener("click", () => changeValue(counter.id, 1));

        mainButtons.appendChild(minusBtn);
        mainButtons.appendChild(plusBtn);

        valueWrapper.appendChild(valueEl);
        valueWrapper.appendChild(mainButtons);

        const extraButtons = document.createElement("div");
        extraButtons.className = "counter-buttons-extra";

        const resetBtn = document.createElement("button");
        resetBtn.className = "btn btn-secondary";
        resetBtn.textContent = "Reset";
        resetBtn.addEventListener("click", () => resetCounter(counter.id));

        const deleteBtn = document.createElement("button");
        deleteBtn.className = "btn btn-danger";
        deleteBtn.textContent = "Smazat";
        deleteBtn.addEventListener("click", () => {
          if (confirm(`Opravdu smazat počítadlo "${counter.name}"?`)) {
            deleteCounter(counter.id);
          }
        });

        extraButtons.appendChild(resetBtn);
        extraButtons.appendChild(deleteBtn);

        card.appendChild(header);
        card.appendChild(valueWrapper);
        card.appendChild(extraButtons);

        container.appendChild(card);
      });
    }

    function changeValue(id, delta) {
      counters = counters.map(c =>
        c.id === id ? { ...c, value: c.value + delta } : c
      );
      saveCounters(counters);
      renderCounters();
      playClickSound();
    }

    function resetCounter(id) {
      counters = counters.map(c =>
        c.id === id ? { ...c, value: 0 } : c
      );
      saveCounters(counters);
      renderCounters();
      playClickSound();
    }

    function deleteCounter(id) {
      counters = counters.filter(c => c.id !== id);
      saveCounters(counters);
      renderCounters();
    }

    function updateCounterName(id, newName) {
      counters = counters.map(c =>
        c.id === id ? { ...c, name: newName } : c
      );
      saveCounters(counters);
      renderCounters();
    }

    function cycleColor(id) {
      counters = counters.map(c => {
        if (c.id !== id) return c;
        const current = c.color || COLORS[0];
        let idx = COLORS.indexOf(current);
        if (idx === -1) idx = 0;
        const next = COLORS[(idx + 1) % COLORS.length];
        return { ...c, color: next };
      });
      saveCounters(counters);
      renderCounters();
      playClickSound();
    }

    function addCounter(name) {
      const trimmed = name.trim();
      const idx = counters.length % COLORS.length;
      const color = COLORS[idx];

      counters.push({
        id: createId(),
        name: trimmed || `Počítadlo ${counters.length + 1}`,
        value: 0,
        color
      });
      saveCounters(counters);
      renderCounters();
      playClickSound();
    }

    document.addEventListener("DOMContentLoaded", () => {
      const input = document.getElementById("newCounterName");
      const btn = document.getElementById("addCounterBtn");

      btn.addEventListener("click", () => {
        addCounter(input.value);
        input.value = "";
        input.focus();
      });

      input.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          addCounter(input.value);
          input.value = "";
        }
      });

      renderCounters();
    });
  </script>
</body>
</html>
