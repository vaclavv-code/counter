<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Můj Counter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f5;
      color: #111;
    }

    body {
      margin: 0;
      padding: 1rem;
      max-width: 900px;
      margin-inline: auto;
      background: #f5f5f5;
    }

    h1 {
      font-size: 1.4rem;
      margin: 0 0 0.8rem 0;
      text-align: left;
    }

    .top-bar {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.8rem;
    }

    .top-bar input {
      flex: 1;
      padding: 0.5rem 0.7rem;
      border-radius: 999px;
      border: 1px solid #d4d4d4;
      background: #fff;
      font-size: 0.95rem;
    }

    .btn {
      padding: 0.5rem 0.9rem;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      user-select: none;
    }

    .btn:active {
      transform: scale(0.97);
    }

    .btn-primary {
      background: #3a86ff;
      color: #fff;
    }

    .btn-secondary {
      background: #eee;
      color: #222;
    }

    .btn-danger {
      background: #ef4444;
      color: #fff;
    }

    .counters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
      gap: 0.9rem;
      margin-top: 0.6rem;
    }

    .counter-card {
      background: #fff;
      border-radius: 1.1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      padding: 0.8rem 0.8rem 0.9rem 0.8rem;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      border: 2px solid transparent;
      transition: transform 0.05s ease-out, box-shadow 0.05s ease-out;
    }

    .counter-card:active {
      transform: translateY(1px);
      box-shadow: 0 1px 4px rgba(0,0,0,0.12);
    }

    .counter-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.4rem;
    }

    .counter-name {
      font-weight: 600;
      font-size: 0.95rem;
      border: none;
      background: transparent;
      padding: 0.1rem 0.3rem;
      border-radius: 0.4rem;
      max-width: 100%;
    }

    .counter-name:focus {
      outline: 1px solid #3a86ff;
      background: #f3f4ff;
    }

    .color-btn {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      flex-shrink: 0;
      box-shadow: 0 0 0 2px #fff, 0 0 0 3px rgba(0,0,0,0.08);
    }

    .menu-btn {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      flex-shrink: 0;
      background: #f3f4f6;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      margin-left: 0.2rem;
    }

    .menu-btn:active {
      transform: scale(0.95);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .counter-value-wrapper {
      background: #f9fafb;
      border-radius: 0.9rem;
      padding: 0.4rem 0.4rem 0.7rem 0.4rem;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: center;
      margin-top: 0.15rem;
    }

    .counter-value {
      font-size: 2.2rem;
      font-weight: 700;
      text-align: center;
      margin: 0.1rem 0 0.35rem 0;
    }

    .counter-buttons-main {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.35rem;
      width: 100%;
    }

    .counter-buttons-main .btn {
      border-radius: 0.9rem;
      padding-block: 0.9rem;
      font-size: 1.5rem;
      min-height: 64px;
    }

    .footer {
      margin-top: 1rem;
      font-size: 0.75rem;
      text-align: center;
      color: #888;
    }

    /* Overlay menu pro Reset / Smazat */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .hidden {
      display: none;
    }

    .menu-dialog {
      background: #fff;
      border-radius: 1rem;
      padding: 1rem;
      width: 90%;
      max-width: 360px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }

    .menu-dialog-title {
      font-weight: 600;
      margin-bottom: 0.6rem;
      font-size: 1rem;
    }

    .menu-dialog-buttons {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      margin-top: 0.6rem;
    }

    .menu-dialog-buttons .btn {
      width: 100%;
      justify-content: center;
      padding-block: 0.6rem;
      font-size: 0.95rem;
      border-radius: 0.7rem;
    }
  </style>
</head>
<body>
  <h1>All counters</h1>

  <div class="top-bar">
    <input id="newCounterName" type="text" placeholder="Název počítadla (např. Pull ups)">
    <button class="btn btn-primary" id="addCounterBtn">+ Přidat</button>
  </div>

  <div id="counters" class="counters"></div>

  <div class="footer">
    Hodnoty se ukládají jen do tohoto zařízení (localStorage).
  </div>

  <!-- Menu overlay pro Reset / Smazat -->
  <div id="menuOverlay" class="overlay hidden">
    <div class="menu-dialog">
      <div class="menu-dialog-title" id="menuTitle">Nastavení počítadla</div>
      <div class="menu-dialog-buttons">
        <button class="btn btn-secondary" id="menuResetBtn">Resetovat na 0</button>
        <button class="btn btn-danger" id="menuDeleteBtn">Smazat počítadlo</button>
        <button class="btn btn-secondary" id="menuCancelBtn">Zrušit</button>
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "my_counter_app_v2";

    const COLORS = [
      "#f97316", // oranžová
      "#6b7280", // šedá
      "#2563eb", // modrá
      "#ec4899", // růžová
      "#10b981", // zelená
      "#7c3aed"  // fialová
    ];

    // Zvuk "kliknutí" – krátký šum
    let audioContext = null;
    function playClickSound() {
      try {
        const AC = window.AudioContext || window.webkitAudioContext;
        if (!AC) return;
        if (!audioContext) {
          audioContext = new AC();
        }

        const duration = 0.03;
        const sampleRate = audioContext.sampleRate;
        const length = sampleRate * duration;
        const buffer = audioContext.createBuffer(1, length, sampleRate);
        const data = buffer.getChannelData(0);

        for (let i = 0; i < length; i++) {
          const envelope = 1 - i / length;
          data[i] = (Math.random() * 2 - 1) * envelope * 0.4;
        }

        const source = audioContext.createBufferSource();
        source.buffer = buffer;

        const gain = audioContext.createGain();
        gain.gain.value = 0.3;

        source.connect(gain);
        gain.connect(audioContext.destination);

        source.start();
      } catch (e) {
        console.warn("Audio error:", e);
      }
    }

    function loadCounters() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return [];
      try {
        const data = JSON.parse(raw);
        return Array.isArray(data) ? data : [];
      } catch {
        return [];
      }
    }

    function saveCounters(counters) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(counters));
    }

    function createId() {
      return "c_" + Date.now().toString(36) + "_" + Math.random().toString(36).slice(2, 7);
    }

    let counters = loadCounters();
    let activeMenuCounterId = null;

    function renderCounters() {
      const container = document.getElementById("counters");
      container.innerHTML = "";

      if (counters.length === 0) {
        const empty = document.createElement("div");
        empty.textContent = "Zatím žádné počítadlo. Přidej si první nahoře.";
        empty.style.color = "#888";
        empty.style.fontSize = "0.9rem";
        empty.style.gridColumn = "1 / -1";
        container.appendChild(empty);
        return;
      }

      counters.forEach(counter => {
        const color = counter.color || COLORS[0];

        const card = document.createElement("div");
        card.className = "counter-card";
        card.dataset.id = counter.id;
        card.style.borderColor = color;

        const header = document.createElement("div");
        header.className = "counter-header";

        const nameInput = document.createElement("input");
        nameInput.className = "counter-name";
        nameInput.value = counter.name || "Bez názvu";
        nameInput.addEventListener("change", () => {
          updateCounterName(counter.id, nameInput.value.trim() || "Bez názvu");
        });

        const headerRight = document.createElement("div");
        headerRight.className = "header-right";

        const colorBtn = document.createElement("button");
        colorBtn.className = "color-btn";
        colorBtn.style.background = color;
        colorBtn.title = "Změnit barvu";
        colorBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          cycleColor(counter.id);
        });

        const menuBtn = document.createElement("button");
        menuBtn.className = "menu-btn";
        menuBtn.innerHTML = "⋮";
        menuBtn.title = "Menu";
        menuBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          openMenu(counter.id);
        });

        headerRight.appendChild(colorBtn);
        headerRight.appendChild(menuBtn);

        header.appendChild(nameInput);
        header.appendChild(headerRight);

        const valueWrapper = document.createElement("div");
        valueWrapper.className = "counter-value-wrapper";

        const valueEl = document.createElement("div");
        valueEl.className = "counter-value";
        valueEl.textContent = counter.value;
        valueEl.style.color = color;

        const mainButtons = document.createElement("div");
        mainButtons.className = "counter-buttons-main";

        const minusBtn = document.createElement("button");
        minusBtn.className = "btn btn-secondary";
        minusBtn.textContent = "–";
        minusBtn.addEventListener("click", () => changeValue(counter.id, -1));

        const plusBtn = document.createElement("button");
        plusBtn.className = "btn btn-primary";
        plusBtn.textContent = "+";
        plusBtn.style.background = color;
        plusBtn.addEventListener("click", () => changeValue(counter.id, 1));

        mainButtons.appendChild(minusBtn);
        mainButtons.appendChild(plusBtn);

        valueWrapper.appendChild(valueEl);
        valueWrapper.appendChild(mainButtons);

        card.appendChild(header);
        card.appendChild(valueWrapper);

        container.appendChild(card);
      });
    }

    function changeValue(id, delta) {
      counters = counters.map(c =>
        c.id === id ? { ...c, value: c.value + delta } : c
      );
      saveCounters(counters);
      renderCounters();
      playClickSound();
    }

    function resetCounter(id) {
      counters = counters.map(c =>
        c.id === id ? { ...c, value: 0 } : c
      );
      saveCounters(counters);
      renderCounters();
      playClickSound();
    }

    function deleteCounter(id) {
      counters = counters.filter(c => c.id !== id);
      saveCounters(counters);
      renderCounters();
    }

    function updateCounterName(id, newName) {
      counters = counters.map(c =>
        c.id === id ? { ...c, name: newName } : c
      );
      saveCounters(counters);
      renderCounters();
    }

    function cycleColor(id) {
      counters = counters.map(c => {
        if (c.id !== id) return c;
        const current = c.color || COLORS[0];
        let idx = COLORS.indexOf(current);
        if (idx === -1) idx = 0;
        const next = COLORS[(idx + 1) % COLORS.length];
        return { ...c, color: next };
      });
      saveCounters(counters);
      renderCounters();
      playClickSound();
    }

    function addCounter(name) {
      const trimmed = name.trim();
      const idx = counters.length % COLORS.length;
      const color = COLORS[idx];

      counters.push({
        id: createId(),
        name: trimmed || `Počítadlo ${counters.length + 1}`,
        value: 0,
        color
      });
      saveCounters(counters);
      renderCounters();
      playClickSound();
    }

    function openMenu(id) {
      activeMenuCounterId = id;
      const overlay = document.getElementById("menuOverlay");
      const title = document.getElementById("menuTitle");
      const counter = counters.find(c => c.id === id);
      title.textContent = counter ? `Nastavení: ${counter.name}` : "Nastavení počítadla";
      overlay.classList.remove("hidden");
    }

    function closeMenu() {
      const overlay = document.getElementById("menuOverlay");
      overlay.classList.add("hidden");
      activeMenuCounterId = null;
    }

    document.addEventListener("DOMContentLoaded", () => {
      const input = document.getElementById("newCounterName");
      const btn = document.getElementById("addCounterBtn");

      btn.addEventListener("click", () => {
        addCounter(input.value);
        input.value = "";
        input.focus();
      });

      input.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          addCounter(input.value);
          input.value = "";
        }
      });

      const overlay = document.getElementById("menuOverlay");
      const resetBtn = document.getElementById("menuResetBtn");
      const deleteBtn = document.getElementById("menuDeleteBtn");
      const cancelBtn = document.getElementById("menuCancelBtn");

      overlay.addEventListener("click", (e) => {
        if (e.target === overlay) {
          closeMenu();
        }
      });

      resetBtn.addEventListener("click", () => {
        if (activeMenuCounterId) {
          resetCounter(activeMenuCounterId);
        }
        closeMenu();
      });

      deleteBtn.addEventListener("click", () => {
        if (activeMenuCounterId) {
          const c = counters.find(c => c.id === activeMenuCounterId);
          const name = c ? c.name : "počítadlo";
          if (confirm(`Opravdu smazat "${name}"?`)) {
            deleteCounter(activeMenuCounterId);
          }
        }
        closeMenu();
      });

      cancelBtn.addEventListener("click", () => {
        closeMenu();
      });

      renderCounters();
    });
  </script>
</body>
</html>
