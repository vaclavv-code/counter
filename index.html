<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>M≈Øj Counter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    /* Glob√°lnƒõ zak√°≈æe oznaƒçov√°n√≠/kop√≠rov√°n√≠ textu */
    * {
      -webkit-user-select: none;
      user-select: none;
    }

    /* V inputech nech√°me mo≈ænost ps√°t a oznaƒçovat text */
    input, textarea {
      -webkit-user-select: text;
      user-select: text;
    }

    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #000;
      color: #f5f5f5;
    }

    body {
      margin: 0;
      padding: 1rem;
      max-width: 900px;
      margin-inline: auto;
      background: #000;
      color: #f5f5f5;
    }

    /* HORN√ç ƒå√ÅST ‚Äì zad√°n√≠ n√°zvu + p≈ôid√°n√≠ */
    .top-bar {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      margin-bottom: 0.8rem;
    }

    .top-bar-main {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .top-bar-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end;
    }

    .top-bar input {
      flex: 1;
      padding: 0.5rem 0.7rem;
      border-radius: 0.6rem;
      border: 1px solid #d4d4d4;
      background: #f9fafb;
      font-size: 1rem;
      font-weight: 650;
      color: #020617;
    }

    .top-bar input::placeholder {
      color: #6b7280;
    }

    .btn {
      padding: 0.5rem 0.9rem;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .btn-primary {
      background: #3b82f6;
      color: #f9fafb;
    }

    .icon-btn {
      width: 48px;
      height: 48px;
      border-radius: 999px;
      border: none;
      background: #111827;
      color: #f9fafb;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1.7rem;
    }

    .icon-btn:active,
    .btn:active {
      transform: scale(0.95);
    }

    /* GRID COUNTER≈Æ */
    .counters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
      gap: 0.9rem;
      margin-top: 0.6rem;
    }

    .counter-card {
      border-radius: 1.1rem;
      box-shadow: 0 2px 12px rgba(0,0,0,0.45);
      padding: 0.7rem;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      color: #f9fafb;
      transition: transform 0.05s ease-out, box-shadow 0.05s ease-out;
    }

    .counter-card:active {
      transform: translateY(1px);
      box-shadow: 0 1px 6px rgba(0,0,0,0.6);
    }

    .counter-name-label {
      font-weight: 800;
      font-size: 1.25rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .counter-value-wrapper {
      background: rgba(0,0,0,0.25);
      border-radius: 0.9rem;
      padding: 0.25rem 0.35rem 0.45rem 0.35rem;
      display: flex;
      flex-direction: column;
      flex: 1;
    }

    .counter-value {
      font-size: 2.8rem;
      font-weight: 800;
      text-align: center;
      margin-bottom: 0.3rem;
    }

    .counter-buttons-main {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.3rem;
      width: 100%;
      margin-top: auto;
    }

    .counter-buttons-main .btn {
      border-radius: 0.9rem;
      padding-block: 1.1rem;
      font-size: 2.4rem;
      font-weight: 800;
      min-height: 80px;
    }

    .footer {
      margin-top: 1rem;
      font-size: 0.75rem;
      text-align: center;
      color: #6b7280;
    }

    /* FULLSCREEN DETAIL */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: stretch;
      justify-content: center;
      z-index: 999;
    }

    .hidden {
      display: none;
    }

    .detail-view {
      background: #020617;
      width: 100%;
      max-width: 900px;
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .detail-header {
      display: flex;
      align-items: center;
      padding: 0.7rem 0.9rem;
      border-bottom: 1px solid #111827;
      gap: 0.6rem;
    }

    .detail-back-btn {
      width: 52px;
      height: 52px;
      border-radius: 999px;
      border: none;
      background: #111827;
      color: #e5e7eb;
      font-size: 1.9rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      flex-shrink: 0;
    }

    .detail-name {
      flex: 1;
      font-size: 1.5rem;
      font-weight: 800;
      background: #f9fafb;
      color: #020617;
      padding: 0.35rem 0.55rem;
      border-radius: 0.7rem;
      border: 1px solid #d4d4d4;
    }

    .detail-body {
      flex: 1;
      padding: 0.5rem 0.9rem 0.9rem 0.9rem;
      display: flex;
      flex-direction: column;
    }

    .detail-color-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.35rem;
      margin-bottom: 0.3rem;
    }

    .detail-color-swatch {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 0 2px #020617;
    }

    .detail-value {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 5.2rem;
      font-weight: 800;
    }

    .detail-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.6rem;
    }

    .detail-buttons .btn {
      border-radius: 1.1rem;
      padding-block: 1.5rem;
      font-size: 3rem;
      font-weight: 800;
      min-height: 96px;
    }
  </style>
</head>
<body>

  <!-- HORN√ç ƒå√ÅST -->
  <div class="top-bar">
    <div class="top-bar-main">
      <input id="newCounterName" type="text" placeholder="N√°zev poƒç√≠tadla">
      <button class="btn btn-primary" id="addCounterBtn">+ P≈ôidat</button>
    </div>
    <div class="top-bar-actions">
      <button class="icon-btn" id="resetAllBtn" title="Resetovat v≈°echny">‚Ü∫</button>
      <button class="icon-btn" id="deleteAllBtn" title="Smazat v≈°echny">üóë</button>
    </div>
  </div>

  <div id="counters" class="counters"></div>

  <div class="footer">
    Hodnoty se ukl√°daj√≠ jen do tohoto za≈ô√≠zen√≠ (localStorage).
  </div>

  <!-- FULLSCREEN DETAIL -->
  <div id="detailOverlay" class="overlay hidden">
    <div class="detail-view">
      <div class="detail-header">
        <button id="detailBackBtn" class="detail-back-btn">‚Üê</button>
        <input id="detailName" class="detail-name">
      </div>
      <div class="detail-body">
        <div id="detailColorRow" class="detail-color-row"></div>
        <div id="detailValue" class="detail-value">0</div>
        <div class="detail-buttons">
          <button id="detailMinusBtn" class="btn btn-secondary">‚àí</button>
          <button id="detailPlusBtn" class="btn btn-primary">+</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "my_counter_app_v3";

    const COLORS = [
      "#f97316", "#6b7280", "#2563eb", "#ec4899", "#10b981",
      "#7c3aed", "#22c55e", "#eab308", "#0ea5e9"
    ];

    let counters = loadCounters();
    let activeDetailId = null;
    let audioContext = null;

    function playClickSound() {
      try {
        const AC = window.AudioContext || window.webkitAudioContext;
        if (!AC) return;
        if (!audioContext) audioContext = new AC();

        const duration = 0.03;
        const sr = audioContext.sampleRate;
        const length = sr * duration;
        const buffer = audioContext.createBuffer(1, length, sr);
        const data = buffer.getChannelData(0);

        for (let i = 0; i < length; i++) {
          const envelope = 1 - i / length;
          data[i] = (Math.random() * 2 - 1) * envelope * 0.4;
        }

        const source = audioContext.createBufferSource();
        const gain = audioContext.createGain();
        gain.gain.value = 0.3;

        source.buffer = buffer;
        source.connect(gain);
        gain.connect(audioContext.destination);
        source.start();
      } catch (e) {}
    }

    function loadCounters() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return [];
      try {
        const data = JSON.parse(raw);
        return Array.isArray(data) ? data : [];
      } catch {
        return [];
      }
    }

    function saveCounters(cs) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(cs));
    }

    function updateCounters(updater, options = { playSound: true }) {
      counters = updater(counters);
      saveCounters(counters);
      renderCounters();
      if (activeDetailId) renderDetail();
      if (options.playSound) playClickSound();
    }

    function createId() {
      return "c_" + Date.now().toString(36) + "_" + Math.random().toString(36).slice(2,7);
    }

    function addCounter(name) {
      const trimmed = name.trim();
      updateCounters(cs => {
        const idx = cs.length % COLORS.length;
        return cs.concat({
          id: createId(),
          name: trimmed || `Poƒç√≠tadlo ${cs.length + 1}`,
          value: 0,
          color: COLORS[idx]
        });
      });
      document.getElementById("newCounterName").value = "";
    }

    function changeValue(id, delta) {
      updateCounters(cs =>
        cs.map(c => c.id === id ? { ...c, value: c.value + delta } : c)
      );
    }

    function updateCounterName(id, newName) {
      const safe = newName.trim() || "Bez n√°zvu";
      updateCounters(
        cs => cs.map(c => c.id === id ? { ...c, name: safe } : c),
        { playSound: false }
      );
    }

    function setColor(id, color) {
      updateCounters(cs =>
        cs.map(c => c.id === id ? { ...c, color } : c)
      );
    }

    function resetAllCounters() {
      if (counters.length === 0) return;
      if (confirm("Opravdu resetovat v≈°echny hodnoty na 0?")) {
        updateCounters(cs => cs.map(c => ({ ...c, value: 0 })));
      }
    }

    function deleteAllCounters() {
      if (counters.length === 0) return;
      if (confirm("Opravdu smazat v≈°echna poƒç√≠tadla?")) {
        updateCounters(() => []);
        closeDetail();
      }
    }

    function attachLongPress(el, callback) {
      let timer = null;

      const start = (e) => {
        if (e.target.closest("button")) return;
        timer = setTimeout(() => {
          timer = null;
          callback();
        }, 500);
      };

      const cancel = () => {
        if (timer) {
          clearTimeout(timer);
          timer = null;
        }
      };

      el.addEventListener("pointerdown", start);
      el.addEventListener("pointerup", cancel);
      el.addEventListener("pointerleave", cancel);
      el.addEventListener("pointercancel", cancel);
    }

    function openDetail(id) {
      activeDetailId = id;
      document.getElementById("detailOverlay").classList.remove("hidden");
      renderDetail();
    }

    function closeDetail() {
      activeDetailId = null;
      document.getElementById("detailOverlay").classList.add("hidden");
    }

    function renderDetail() {
      const c = counters.find(x => x.id === activeDetailId);
      if (!c) return;

      const nameInput = document.getElementById("detailName");
      const valueEl = document.getElementById("detailValue");
      const minusBtn = document.getElementById("detailMinusBtn");
      const plusBtn = document.getElementById("detailPlusBtn");
      const colorRow = document.getElementById("detailColorRow");

      nameInput.value = c.name;
      valueEl.textContent = c.value;
      valueEl.style.color = c.color;
      plusBtn.style.background = c.color;

      colorRow.innerHTML = "";
      COLORS.forEach(col => {
        const b = document.createElement("button");
        b.className = "detail-color-swatch";
        b.style.background = col;
        if (col === c.color) {
          b.style.boxShadow = "0 0 0 3px #fff";
        }
        b.addEventListener("click", () => setColor(c.id, col));
        colorRow.appendChild(b);
      });

      minusBtn.onclick = () => changeValue(c.id, -1);
      plusBtn.onclick = () => changeValue(c.id, 1);
    }

    function renderCounters() {
      const container = document.getElementById("counters");
      container.innerHTML = "";

      if (counters.length === 0) {
        const empty = document.createElement("div");
        empty.textContent = "Zat√≠m ≈æ√°dn√© poƒç√≠tadlo.";
        empty.style.color = "#6b7280";
        empty.style.fontSize = "0.9rem";
        empty.style.gridColumn = "1 / -1";
        container.appendChild(empty);
        return;
      }

      counters.forEach(c => {
        const card = document.createElement("div");
        card.className = "counter-card";
        card.style.background = c.color;

        const nameEl = document.createElement("div");
        nameEl.className = "counter-name-label";
        nameEl.textContent = c.name;

        const wrap = document.createElement("div");
        wrap.className = "counter-value-wrapper";

        const val = document.createElement("div");
        val.className = "counter-value";
        val.textContent = c.value;

        const btns = document.createElement("div");
        btns.className = "counter-buttons-main";

        const minusBtn = document.createElement("button");
        minusBtn.className = "btn btn-secondary";
        minusBtn.textContent = "‚àí";
        minusBtn.addEventListener("click", () => changeValue(c.id, -1));

        const plusBtn = document.createElement("button");
        plusBtn.className = "btn btn-primary";
        plusBtn.textContent = "+";
        plusBtn.style.background = "#020617";
        plusBtn.style.color = "#f9fafb";
        plusBtn.addEventListener("click", () => changeValue(c.id, 1));

        btns.appendChild(minusBtn);
        btns.appendChild(plusBtn);

        wrap.appendChild(val);
        wrap.appendChild(btns);

        card.appendChild(nameEl);
        card.appendChild(wrap);

        attachLongPress(card, () => openDetail(c.id));

        container.appendChild(card);
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      const input = document.getElementById("newCounterName");

      document.getElementById("addCounterBtn").addEventListener("click", () => {
        addCounter(input.value);
      });

      input.addEventListener("keypress", e => {
        if (e.key === "Enter") {
          addCounter(e.target.value);
          e.preventDefault();
        }
      });

      document.getElementById("resetAllBtn").addEventListener("click", resetAllCounters);
      document.getElementById("deleteAllBtn").addEventListener("click", deleteAllCounters);

      document.getElementById("detailBackBtn").addEventListener("click", closeDetail);

      document.getElementById("detailName").addEventListener("change", e => {
        if (activeDetailId) updateCounterName(activeDetailId, e.target.value);
      });

      renderCounters();
    });
  </script>
</body>
</html>
